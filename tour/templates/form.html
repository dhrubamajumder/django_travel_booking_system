{% include "index.html" %}
{% block content %}

<div class="backg" style="background: linear-gradient(135deg, #1d3945, #12242a, #1d3854); padding: 10px; border-radius: 10px;">
  <div class="container mb-5 justify-content-center d-flex mt-3">
    <div class="card shadow-lg" style="width: 50rem;">
      <div class="card-header bg-primary text-white text-center">
        <h3>Travel Booking Form</h3>
      </div>

      <div class="card-body" id="booking-form">
        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <form method="post">
          {% csrf_token %}

          <!-- Full Name -->
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control" name="full_name" placeholder="Enter your full name" required>
          </div>

          <!-- Address -->
          <div class="mb-3">
            <label class="form-label">Address</label>
            <input type="text" class="form-control" name="address" placeholder="Enter your address" required>
          </div>

          <!-- Phone -->
          <div class="mb-3">
            <label class="form-label">Phone Number</label>
            <input type="tel" class="form-control" name="phone" placeholder="+8801XXXXXXXXX" required>
          </div>

          <!-- Destination -->
          <div class="mb-3">
            <label class="form-label">Destination</label>
            <input type="text" class="form-control" id="destination" name="destination_name" placeholder="Enter destination" readonly required>
            <input type="hidden" id="destination_id" name="destination">
          </div>

          <!-- Guest & Price -->
          <div class="row">
            <div class="col-6 mb-3">
              <label class="form-label">Guest</label>
              <input type="number" class="form-control" id="guest" name="guest" min="1" value="1" required>
            </div>

            <div class="col-6 mb-3">
              <label class="form-label">Price</label>
              <input type="number" class="form-control" name="price" id="price" readonly required>
            </div>
          </div>

          <!-- Submit -->
          <div class="text-center">
            <button type="submit" class="btn btn-success btn-lg">Book Now</button>
            <a href="{% url 'home' %}" class="btn btn-secondary btn-lg">Back</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const destinationInput = document.getElementById("destination");
  const destinationIdInput = document.getElementById("destination_id");
  const priceInput = document.getElementById("price");
  const guestInput = document.getElementById("guest");
  let currentPricePerPerson = 0;

  // Update price when guest changes
  guestInput.addEventListener("input", function() {
    const guests = parseInt(guestInput.value) || 1;
    priceInput.value = currentPricePerPerson * guests;
  });

  // Read from localStorage and fill form
  const storedDestination = localStorage.getItem('selectedDestination');
  const storedPrice = localStorage.getItem('selectedPrice');
  const storedId = localStorage.getItem('selectedDestinationId');
  const storedSeats = localStorage.getItem('selectedSeats');

  if (storedDestination) {
    destinationInput.value = storedDestination;
    localStorage.removeItem('selectedDestination');
  }
  if (storedPrice) {
    currentPricePerPerson = parseInt(storedPrice);
    const guests = parseInt(guestInput.value) || 1;
    priceInput.value = currentPricePerPerson * guests;
    localStorage.removeItem('selectedPrice');
  }
  if (storedId) {
    destinationIdInput.value = storedId;
    localStorage.removeItem('selectedDestinationId');
  }
  if (storedSeats) {
    guestInput.max = storedSeats;
    localStorage.removeItem('selectedSeats');
  }
});
</script>

{% endblock %}